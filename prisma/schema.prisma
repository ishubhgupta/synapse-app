// Prisma schema for Synapse Core MVP

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enable pgvector extension
// Run this SQL in your Neon database:
// CREATE EXTENSION IF NOT EXISTS vector;

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  bookmarks Bookmark[]

  @@map("users")
}

model Bookmark {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Core fields
  title       String
  url         String?
  contentType String // 'video' | 'product' | 'article' | 'tweet' | 'note' | 'image'

  // Content
  rawContent String? @db.Text

  // Media
  thumbnail String?
  favicon   String?

  // Image-specific fields
  imageUrl         String? // S3 URL for stored images
  imageStorageKey  String? // S3 storage key for deletion
  imageWidth       Int?    // Image dimensions
  imageHeight      Int?
  imageSize        Int?    // Size in bytes
  imageFormat      String? // jpg, png, webp, etc.
  
  // AI Image Analysis
  ocrText          String? @db.Text // Extracted text from image (OCR)
  imageDescription String? @db.Text // AI-generated description
  imageObjects     String[]         // Detected objects/concepts

  // Metadata (flexible JSON for type-specific data)
  metadata Json?

  // Organization
  tags     String[]
  category String? // 'work' | 'personal' | 'research' | 'inspiration' | 'shopping' | 'entertainment' | 'learning'

  // Vector embedding for semantic search (768 dimensions for Google Gemini)
  embedding Unsupported("vector(768)")?

  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  extractedAt DateTime?

  @@index([userId, createdAt])
  @@index([userId, contentType])
  @@index([userId, category])
  @@map("bookmarks")
}
